<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><!--meta(http-equiv="Content-Security-Policy", content="default-src 'self' ; style-src 'self' 'unsafe-inline' ; object-src 'none' ; img-src 'self' ; referrer no-referrer ;")--><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#ff8c00"><title>Privacy and Google Analytics</title><meta name="description" content="You can fine tune Google Analytics to protect the privacy of your visitors"><base href="http://gu.illau.me/posts/privacy-and-google-analytics/" target="_top"><link href="/css/main.css" rel="stylesheet"><script src="/js/analytics.js" defer async></script><script src="/js/ui.js" defer async></script><link href="/manifest.webmanifest" rel="manifest"><link href="http://feeds.feedburner.com/just-a-blog" rel="alternate" type="application/rss+xml" title="A blog by G.C. Marty"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"></head><body><nav><h1 class="name"><a href="/">A blog<small> by G.C. Marty</small></a></h1><div style="display:none" class="menu icon-menu"></div><ul class="nav-links"><li class="text-link"><a href="/about.html">about</a></li><li class="text-link"><a href="/apps.html">apps</a></li><li class="text-link"><a href="/talks.html">talks</a></li><li class="text-link"><a href="/posts.html">posts</a></li></ul><div class="social-media"><a href="https://github.com/gmarty" class="icon-github"></a><a href="https://twitter.com/g_marty" class="icon-twitter"></a></div></nav><div class="content"><div class="post-head group"><a href="/posts/privacy-and-google-analytics/"><h1 class="post-title">Privacy and Google Analytics</h1></a><span class="post-date">2014/12/08</span><span class="post-reading-time"></span></div><div class="post-body markdown"><h2><a name="the-problem" class="anchor" href="#the-problem"><span class="header-link"></span></a>The problem</h2>
<p>After reading a post comparing analytics solutions, I realised most people ignore that Google Analytics can be fine tuned to comply with stricter privacy policies. In this post, I&#39;ll share the solutions I implemented to keep using Google Analytics without compromising my visitors (a.k.a. yourself) privacy.</p>
<p>Please note that the code only relates to the latest <code>analytics.js</code> API. Look for support pages for older versions of Google Analytics.</p>
<h2><a name="the-solutions" class="anchor" href="#the-solutions"><span class="header-link"></span></a>The solutions</h2>
<h3><a name="disable-data-sharing" class="anchor" href="#disable-data-sharing"><span class="header-link"></span></a>Disable data sharing</h3>
<p>By default, the data collected from Google Analytics are shared across several services like:</p>
<ul>
<li>Other Google products like AdWords</li>
<li>Industries aggregate trends that allow comparing your result with web sites in the same sector</li>
<li>Technical support...</li>
</ul>
<p>Though this data sharing should be harmless most of the time, you can disable it in your account settings. You can read more about it on the <a href="https://support.google.com/analytics/answer/1011397?hl=en">data sharing settings</a> support page.</p>
<h3><a name="anonymise-ip-address" class="anchor" href="#anonymise-ip-address"><span class="header-link"></span></a>Anonymise IP address</h3>
<p>Google Analytics has a built-in feature to anonymise IP address (see this <a href="https://support.google.com/analytics/answer/2763052?hl=en">help page</a> for details). When enabled, the last few digits of the visitor&#39;s IP address are set to 0 (IPv6 is supported).
In theory it is not possible for Google to map an anonymised IP address to a specific user. Also, according to their documentation, the complete IP address is never logged.</p>
<p>However, I read the relevant document carefully and noticed it&#39;s not very clear to me if Google logs the IP address when the <code>analytics.js</code> file is requested from their server. If you&#39;re a bit paranoid, you may decide not to trust Google here. In such case, you&#39;ll want to proxy it on your own domain and refresh it as often as possible. I haven&#39;t tried myself, but if you&#39;re doing that, let me know as I&#39;d love to read more.</p>
<p>Obviously, the down side of this setting is you get a less accurate geographic report as it is based on the IP address. But who needs a granularity to the level of a city?</p>
<h3><a name="implement-an-opt-out-mechanism" class="anchor" href="#implement-an-opt-out-mechanism"><span class="header-link"></span></a>Implement an opt-out mechanism</h3>
<p>You can easily give your users the ability to deactivate tracking. Just create a setting in your app that sets the following property to <code>true</code>:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nb">window</span><span class="p">[</span><span class="s1">&#39;ga-disable-UA-XXXXXX-Y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// Replace UA-XXXXXX-Y by your Google Analytics ID</span>
</pre></div>
</code></pre>
<p>You can persist this setting in your user account, so that her preference is is kept whatever the device she&#39;s using to access your website. But for performance reason, I recommend not to load Google Analytics at all when your user has opted out.
You can read more about <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced#optout">user opt-out</a> in the help pages.</p>
<h3><a name="dont-use-cookies" class="anchor" href="#dont-use-cookies"><span class="header-link"></span></a>Don&#39;t use cookies</h3>
<p>Though not directly related to privacy, not setting cookies is likely to increase your visitors confidence while removing the need to display a message related to the <a href="https://en.wikipedia.org/wiki/HTTP_cookie#EU_cookie_directive">EU cookie directive</a>.</p>
<p>Instead of cookies, use local storage for storing the visitor identifier used by Google Analytics, the so called <code>clientId</code> parameter. This technique has a beneficial aspect on performance as well. The browser won&#39;t send all the cookie detail with every request made to an asset located in the same domain as the page.</p>
<p>Here is the code used in this blog:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;UA-XXXXXX-Y&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="c1">// Use your own ID!</span>
  <span class="s1">&#39;storage&#39;</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
  <span class="s1">&#39;clientId&#39;</span><span class="o">:</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;gaClientId&#39;</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">ga</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tracker</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;gaClientId&#39;</span><span class="p">,</span> <span class="nx">tracker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;clientId&#39;</span><span class="p">));</span>
<span class="p">});</span>
<span class="nx">ga</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">,</span><span class="s1">&#39;pageview&#39;</span><span class="p">)</span>
</pre></div>
</code></pre>
<h3><a name="comply-with-do-not-track" class="anchor" href="#comply-with-do-not-track"><span class="header-link"></span></a>Comply with Do Not Track</h3>
<p>The DNT is not only exposed to the client as a HTTP header but also as a property on the <code>navigator</code> object: <code>navigator.doNotTrack</code>. This returns:</p>
<ul>
<li><code>&#39;1&#39;</code> (the visitor does not want to be tracked)</li>
<li><code>&#39;0&#39;</code> (the visitor wants to be tracked)</li>
<li><code>null</code> or <code>&#39;unspecified&#39;</code> (the visitor tells nothing about her preference)</li>
</ul>
<p>You can wrap the code responsible for loading Google Analytics in a <code>if</code> statement like I do in this blog (examine the source for yourself if you don&#39;t believe me!):</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">doNotTrack</span> <span class="o">!==</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Load Google Analytics and track user.</span>
<span class="p">}</span>
</pre></div>
</code></pre>
<h3><a name="force-ssl" class="anchor" href="#force-ssl"><span class="header-link"></span></a>Force SSL</h3>
<p>This blog is hosted on Github pages. Unfortunately, https is not (yet?) supported. The least I could do was to force the <code>analytics.js</code> file and the beacon to be respectively received and sent encrypted.
More info about the <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/field-reference#forceSSL"><code>forceSSL</code> setting</a> is available.</p>
<h2><a name="the-challenge" class="anchor" href="#the-challenge"><span class="header-link"></span></a>The challenge</h2>
<p>Some of the solutions presented here depend on your level of trust. I decided to trust Google even if I can never have the certitude that they really do what they say they do.
So after all, your trust level may be different and you can decide whether to apply the solutions mentioned above or turn to other analytics services, like <a href="http://piwik.org/">Piwik</a>.</p>
<p>Also, I would have loved to see Google making some of these options easier. For example, support of DNT could have been made an option in the account settings. Also, we can&#39;t create a custom IP masking function to push anonymisation even further.</p>
<p>Google Analytics offer some very basic privacy aware options, but they should offer more!</p>
</div><div class="social"><a href="https://twitter.com/share" class="twitter-share-button">Tweet</a><div data-size="medium" data-annotation="bubble" data-width="300" class="g-plusone"></div><a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a></div><div id="comments"><div id="disqus_thread"></div></div><script>// Hacker News
(function(d, t) {
  var g = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
  g.src = '//hnbutton.appspot.com/static/hn.min.js';
  s.parentNode.insertBefore(g, s);
}(document, 'script'));

// Twitter
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

// Google Plus
(function() {
  var po = document.createElement('script'); po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();

// Disqus
var disqus_shortname = 'gmarty';
(function() {
    var dsq = document.createElement('script'); dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script></div></body></html>