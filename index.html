<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><meta http-equiv="Content-Security-Policy" content="default-src 'self' http://gu.illau.me; script-src 'self' 'unsafe-inline' 'unsafe-eval' http://gu.illau.me http://www.google-analytics.com http://hnbutton.appspot.com https://platform.twitter.com https://apis.google.com http://gmarty.disqus.com; style-src 'self' 'unsafe-inline' http://gu.illau.me http://fonts.googleapis.com http://a.disquscdn.com; img-src 'self' http://gu.illau.me https://*.googleusercontent.com http://www.google-analytics.com https://syndication.twitter.com https://*.disqus.com https://*.disquscdn.com; font-src 'self' http://gu.illau.me http://fonts.gstatic.com https://fonts.gstatic.com; object-src 'none'; frame-src https://www.youtube-nocookie.com http://hnbutton.appspot.com http://disqus.com https://apis.google.com https://accounts.google.com https://plusone.google.com http://platform.twitter.com;"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#ff8c00"><title>A blog by G.C. Marty</title><meta name="description" content="A blog about JavaScript, HTML, the web platform, NLP and to how optimise them all!"><base href="http://gu.illau.me/" target="_top"><link href="/css/main.css" rel="stylesheet"><script src="/js/analytics.js" defer async></script><script src="/js/ui.js" defer async></script><link href="/manifest.webmanifest" rel="manifest"><link href="http://feeds.feedburner.com/just-a-blog" rel="alternate" type="application/rss+xml" title="A blog by G.C. Marty"><link href="/favicon.ico" rel="shortcut icon" type="image/x-icon"></head><body><div class="content"><div class="inner-content"><div class="scroller"><div class="post-head group"><a href="/posts/augmented-reality-computer-vision/"><h1 class="post-title">Augmented reality &amp; computer vision</h1></a><span class="post-date">2017/02/15</span><span class="post-reading-time"></span></div><div class="post-body markdown"><blockquote>
<p><strong>tl;dr:</strong> Media capture, object detection and WebGL can be combined to hack a simple augmented reality experience. See my demo called <a href="https://gmarty.github.io/all-saints-ar/">we are all Saints</a>.</p>
</blockquote>
<p>To simplify things, augmented reality is based mainly on 2 technologies:</p>
<ul>
<li>Sensors to track the position and orientation of the user field of view (FOV)</li>
<li>Computer vision to detect objects in the user FOV</li>
</ul>
<p>Of course modern AR headsets like Hololens combine both to create the best experience possible. I explored using common devices with web technologies to create a simple AR experience. I decided to go for computer vision applied to media capture.</p>
<p><img src="https://github.com/gmarty/all-saints-ar/blob/gh-pages/demo.jpg?raw=true" alt="Screenshot of the demo"></p>
<h2><a name="object-detection" class="anchor" href="#object-detection"><span class="header-link"></span></a>Object detection</h2>
<p>There are few different libraries to detect objects in an image. Most of them seem to be based on <a href="https://en.wikipedia.org/wiki/OpenCV">OpenCV</a>, ported to JavaScript via emscripten.
I didn&#39;t spend too much time looking for a library and quickly settled for <a href="https://github.com/mtschirs/js-objectdetect">js-objectdetect</a>. It&#39;s hand-written (as opposed to converted via emscripten) so it makes easy to read, understand and debug if needed. It can detect different types of objects but I used human faces here.</p>
<p>Once set up properly, <code>js-objectdetect</code> accepts a video element as an input, so I just pass to it the one that displays the camera feed I got from <code>getUserMedia</code>.</p>
<p>It return the coordinates in pixel of the faces detected (left, top, width and height).</p>
<h2><a name="recreating-a-virtual-3d-space" class="anchor" href="#recreating-a-virtual-3d-space"><span class="header-link"></span></a>Recreating a virtual 3D space</h2>
<p>Next step is to place the faces detected in the image in a virtual 3D space by estimating their respective positions. I used A-Frame to create the 3D world because this framework is easy to use.</p>
<p>Positioning an element on the <code>x</code> and <code>y</code> axes is really easy. We need to convert the position in the (-1, 1) range, more about that later. For example a point centred in the image will have both its <code>x</code> and <code>y</code> values set to <code>0</code>. Knowing the position in pixels and the size of the video the values are easy to get (Also the <code>y</code> axis direction is reverse in the web and WebGL). For the <code>x</code> axis, half the width needs to be added so that the element is horizontally centred on the face.</p>
<p>The <code>z</code> axis is a bit trickier. It needs to get estimated and calibrated. I used the height value. I noticed that once detected my face takes at most 80% of the image height when I stand at about 50cm from the camera. The further I step back, say about 2m, the smaller my face gets, to take about 30% of the screen height.</p>
<p>I used these distances as the values for the camera frustum near and far clipping planes (<code>near</code> and <code>far</code> attributes on the <code>&lt;a-camera&gt;</code> element).</p>
<p>Then I only need to convert and clamp the height of the face detected between the % values of image height that I determined above. Once converted to the (-1, 1) range, they&#39;ll vary proportionally between 50cm and 2m. That gives me a good enough approximation of where my face is located in respect to the camera.</p>
<p>I also used the detected height to position the virtual element a few apparent centimetres on top the faces.</p>
<h2><a name="overlaying" class="anchor" href="#overlaying"><span class="header-link"></span></a>Overlaying</h2>
<p> A-Frame uses Three.js under the hood. That&#39;s what I&#39;m using to perform computations.</p>
<p>Now that I&#39;ve got the x, y and z position in the (-1, 1) range I need to unproject this vector along the active camera. That is not as complicated as it sounds:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kr">const</span> <span class="nx">pos</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">z</span><span class="p">).</span><span class="nx">unproject</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>
</pre></div>
</code></pre>
<p>This returns a vector corresponding to the position in space of the object given the current FOV (i.e. camera).</p>
<p>Finally I can set the position of the A-Frame element in the virtual space that I want to super impose over faces:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span>
</pre></div>
</code></pre>
<h2><a name="conclusion" class="anchor" href="#conclusion"><span class="header-link"></span></a>Conclusion</h2>
<p>This experiment wasn&#39;t as hard as it sounded at first and the result is quite convincing. I learnt a lot about projection and unprojection in the process. As usual the code is on GitHub as <a href="https://github.com/gmarty/all-saints-ar">all-saints-ar</a> because we are all saints!</p>
</div><div class="comments"><a href="/posts/augmented-reality-computer-vision/#comments"><span class="icon-bubbles"></span>Comments</a></div><div class="post-head group"><a href="/posts/experimenting-with-vr/"><h1 class="post-title">Experimenting with VR</h1></a><span class="post-date">2016/12/07</span><span class="post-reading-time"></span></div><div class="post-body markdown"><p>I just finished a short series of <a href="https://gmarty.github.io/VR-diary/">experimentations about virtual reality called VR Diary</a>. Here&#39;s a brief summary of why and how.</p>
<h2><a name="vr-but-what-for" class="anchor" href="#vr-but-what-for"><span class="header-link"></span></a>VR, but what for?</h2>
<p>Creating content for virtual reality is easy. <a href="https://aframe.io/">A-Frame</a> is probably the easiest way to get started. It&#39;s entirely free and open-source and only requires a basic of HTML programming. On other projects, I used <a href="https://developers.google.com/vr/unity/">Google VR SDK for Unity</a> and the graphic UI of Unity allows you to create content without even typing a single line of code.</p>
<p>So now the real question is what are we going to use VR for? VR is just a medium and in itself has no value.</p>
<p>This is what I explored in this project. VR is an immersive and engaging platform so I decided to use it to share personal experiences with the readers.</p>
<p>It took a direction towards philosophical questioning and reality challenging that I hadn&#39;t expected. But overall it&#39;s been successful from a personal standpoint: the experiments are consistent (except maybe the first one) and I&#39;ve been able to go through the 6 days.</p>
<h2><a name="working-as-a-hobby" class="anchor" href="#working-as-a-hobby"><span class="header-link"></span></a>Working as a hobby</h2>
<p>An essential aspect to this experiment is being on holiday with a lot of free time. I dedicated about 2 or 3 hours a day actively working on the VR experiment and writing the post. The rest of the day was spent thinking passively about what to do next.</p>
<p>This liberty was essential to generate new ideas to experiment. Creative people know you can&#39;t just sit at a desk and expect to get new ideas. That&#39;s when you go out for a walk, sit in the grass, spend some time in a zoo or a museum that you release the most of your creative potential.</p>
<p>I thoroughly enjoy this lifestyle of working actively a few hours in the morning and passively for the rest of the day. Maybe that&#39;s how life should be: dedicating most of your time to creativity and self-expression and work only for how long is necessary. This is something I want to explore more in the future.</p>
</div><div class="comments"><a href="/posts/experimenting-with-vr/#comments"><span class="icon-bubbles"></span>Comments</a></div><div class="post-head group"><a href="/posts/mozilla-iot-meetup-london-october-2016/"><h1 class="post-title">Mozilla IOT Meetup London October 2016</h1></a><span class="post-date">2016/10/14</span><span class="post-reading-time"></span></div><div class="post-body markdown"><p>On Wednesday 12, October (2 days ago) the first <a href="https://www.meetup.com/Mozilla-IOT/">Mozilla IOT London meetup</a> took place at the Mozilla Common Space near London Bridge.</p>
<h2><a name="a-bit-of-history" class="anchor" href="#a-bit-of-history"><span class="header-link"></span></a>A bit of history</h2>
<p>The meetup was rebranded from the previous Firefox OS meetup group. A lot happened at Mozilla this year. The Firefox OS project was turned into a community project and the Connected Devices team was created.</p>
<p>Now that things got more stable we decided it was a good time to resume a series of meetups.</p>
<p>This was the first session so we&#39;re still learning and experimenting, but we&#39;re planning on doing monthly or bimonthly meetups. This first session was not recorded, but the plan is to record or stream the next ones.</p>
<h2><a name="the-first-session" class="anchor" href="#the-first-session"><span class="header-link"></span></a>The first session</h2>
<p>Meetups are and should always be about meeting people so we want to emphasise the social aspect of it and making a place where ideas are shared and discussions happen naturally.</p>
<p><img src="http://gu.illau.me/img/posts/mozilla-iot-meetup-london-october-2016/francisco-on-mozilla-connected-devices.jpg" alt="Francisco speaking about the creation of the Connected Devices team." title="Francisco speaking about the creation of the Connected Devices team."></p>
<p>For this first session, we had a nice lineup of speakers:</p>
<ul>
<li><a href="https://twitter.com/mepartoconmigo">Francisco Jordano</a> on <a href="https://docs.google.com/presentation/d/1cJXpLvk2qQ7MIEbcTjNn3uq67OuA_0kkxewZulajGvI/present">introducing Mozilla IOT meetup</a></li>
<li><a href="https://twitter.com/marcwalsh">Marc Walsh</a> on what to expect in the <a href="https://vimeo.com/154774646">IOT space</a> at <a href="http://mozillafestival.org/">MozFest 2016</a></li>
<li><a href="https://twitter.com/SamuelGiles_">Sam Giles</a> on <a href="https://docs.google.com/presentation/d/1ErECQTzBgirwN-qMXtE3hnPU1l6aYt5xc5SPD8z7i-0/present">the physical web and Project Magnet</a></li>
<li><a href="https://twitter.com/RebeccaAJones">Becky Jones</a> with just like magic - Design thinking meets the Internet of Things</li>
</ul>
<p>In addition to the amazing speakers above I wanted to thank <a href="https://twitter.com/Mandyc0907">Mandy</a> for the coordination, <a href="https://twitter.com/dietrich">Dietrich</a> and the devrel team for sponsoring the meetup and all the attendees.</p>
<h2><a name="whats-next" class="anchor" href="#whats-next"><span class="header-link"></span></a>What&#39;s next?</h2>
<p>We&#39;re super happy to receive feedback from the participants. If you happen to be in London during one our of next sessions, make sure you&#39;re attending and let us know what would you like this meetup to be?</p>
<p><img src="http://gu.illau.me/img/posts/mozilla-iot-meetup-london-october-2016/becky-jones-inspiring-talk.jpg" alt="The talented Becky Jones delivering an inspiring talk." title="The talented Becky Jones delivering an inspiring talk."></p>
<p>See you soon!</p>
</div><div class="comments"><a href="/posts/mozilla-iot-meetup-london-october-2016/#comments"><span class="icon-bubbles"></span>Comments</a></div><div class="pagination group"><a href="/page/1/" class="older">&#8592; Older</a></div></div></div></div><nav><h1 class="name"><a href="/">A blog<small>by Guillaume C. Marty</small></a></h1><div class="menu icon-menu"></div><ul class="nav-links"><li class="text-link"><a href="/about.html">about</a></li><li class="text-link"><a href="/apps.html">apps</a></li><li class="text-link"><a href="/talks.html">talks</a></li><li class="text-link"><a href="/posts.html">posts</a></li></ul><div class="social-media"><a href="https://twitter.com/g_marty"><img src="/img/twitter.svg"></a><a href="https://github.com/gmarty"><img src="/img/github.svg"></a><a href="https://uk.linkedin.com/in/gmarty/en"><img src="/img/linkedin.svg"></a></div></nav></body></html>